# Syst√®me de Cosm√©tiques Kids Tasks - Sp√©cifications Compl√®tes

## üìã **Contexte et Probl√©matique**

### **Situation Actuelle**
- Syst√®me de cosm√©tiques rudimentaire avec seulement des emojis (`üë§`, `üëî`)
- D√©pendance aux URLs d'images de l'int√©gration (non accessibles)
- Fonction `generateCosmeticDataFromName()` tr√®s limit√©e
- Pas de gestion visuelle des cosm√©tiques √©quip√©s

### **Objectif**
Cr√©er un syst√®me complet de cosm√©tiques (avatars, tenues, accessoires) comme r√©compenses, **sans d√©pendre d'URLs d'images externes**, inspir√© d'Habitica mais avec un style moderne et flat design.

## üéÆ **Inspiration Habitica - Analyse**

### **Ce qui marche bien chez Habitica :**
- **Avatars par couches** : Peau + cheveux + yeux + v√™tements + accessoires
- **Collections th√©matiques** : √âv√©nements saisonniers, r√©compenses sp√©ciales
- **Raret√© visuelle** : Couleurs distinctes pour commun/rare/√©pique/l√©gendaire
- **Progression motivante** : D√©blocage par achievements et √©v√©nements
- **Aper√ßu instantan√©** : Pr√©visualisation avant achat
- **Style coh√©rent** : Design system unifi√©

### **Adaptation : "Habitica meets Flat Design"**
- Silhouettes arrondies, style material design
- Couleurs modernes et inclusives
- Animations CSS douces
- Int√©gration native avec le design system existant

## üé® **Architecture du Syst√®me**

### **1. Syst√®me d'Avatar par Couches CSS/SVG**

#### **Structure des Couches**
```html
<div class="kt-avatar-builder">
  <div class="avatar-preview">
    <svg class="avatar-base">
      <g class="body-layer"></g>      <!-- Base corporelle -->
      <g class="hair-layer"></g>      <!-- Cheveux -->
      <g class="eyes-layer"></g>      <!-- Yeux/visage -->
      <g class="outfit-layer"></g>    <!-- V√™tements -->
      <g class="accessory-layer"></g> <!-- Accessoires -->
    </svg>
  </div>
</div>
```

#### **Composants d'Avatar**
- **Base corporelle** : Silhouettes arrondies, tons de peau inclusifs
- **Cheveux** : 8-10 styles (court, long, boucl√©, tresse) en SVG
- **Yeux** : Expressions diverses pour personnalit√©
- **V√™tements** : T-shirts, robes, costumes par overlay CSS
- **Accessoires** : Chapeaux, lunettes, bijoux en √©l√©ments flottants

### **2. Collections Th√©matiques**

#### **Collections Principales**
- **Quotidien** : V√™tements normaux (t-shirt, jean, robe)
- **M√©tiers** : Docteur, pompier, enseignant, astronaute
- **Fantaisie** : Pirate, princesse, super-h√©ros, magicien
- **Saisons** : Halloween, No√´l, √©t√©, hiver
- **Sports** : Football, natation, danse, arts martiaux

#### **Syst√®me de Raret√©**
- **Commun** (gris #9e9e9e) : Couleurs basiques, pas d'effets
- **Rare** (vert #4caf50) : Bordure color√©e subtile
- **√âpique** (bleu #2196f3) : Gradient + animation douce
- **L√©gendaire** (or #ffc107) : Effets de particules CSS + aura

### **3. Structure de Donn√©es**

#### **Format des Cosm√©tiques**
```javascript
const cosmeticItem = {
  id: "pirate_hat_001",
  name: "Chapeau de Pirate",
  type: "accessory", // avatar, outfit, accessory, background
  category: "fantasy",
  rarity: "epic",
  unlock_condition: {
    type: "achievement",
    requirement: "complete_10_tasks"
  },
  asset_data: {
    svg_path: "accessories/hats/pirate.svg",
    css_classes: ["pirate-hat", "animated"],
    position: { x: 0, y: -20 }
  },
  compatible_with: ["all_outfits"],
  exclusive_with: ["other_hats"]
};
```

#### **Collections JSON**
```javascript
const cosmeticCollections = {
  "daily": {
    items: {
      "tshirt-red": { rarity: "common", type: "outfit" },
      "jeans-blue": { rarity: "common", type: "outfit" }
    }
  },
  "fantasy": {
    items: {
      "pirate-hat": { rarity: "epic", type: "accessory" },
      "princess-crown": { rarity: "legendary", type: "accessory" }
    }
  }
};
```

## üõ†Ô∏è **Plan d'Impl√©mentation**

### **Phase 1: Mockups et Prototypes**

#### **Mockups √† Cr√©er**
1. **Avatar Builder** (`mockups/avatar-builder.html`)
   - Interface style Habitica avec aper√ßu central
   - Panneaux lat√©raux pour cat√©gories
   - Style flat design moderne

2. **Collection d'Avatars** (`mockups/avatar-layers.html`)
   - D√©monstration des couches SVG
   - Assemblage technique des √©l√©ments

3. **Child Card Int√©gr√©e** (`mockups/child-card-cosmetics.html`)
   - Avatar complet dans la carte enfant
   - Mode compact et d√©taill√©

4. **Syst√®me de R√©compenses** (`mockups/cosmetic-rewards.html`)
   - Animation de drop d'items
   - Catalogue et filtres

5. **Collections Th√©matiques** (`mockups/cosmetic-collections.html`)
   - Visualisation des diff√©rentes collections

#### **Structure CSS des Mockups**
```css
.kt-avatar-builder {
  display: grid;
  grid-template-columns: 250px 1fr 250px;
  gap: var(--kt-space-lg);
  padding: var(--kt-space-lg);
}

.avatar-preview {
  display: flex;
  justify-content: center;
  align-items: center;
  background: var(--kt-surface-variant);
  border-radius: var(--kt-radius-lg);
  padding: var(--kt-space-xl);
}

.avatar-base {
  width: 200px;
  height: 200px;
  transition: all var(--kt-transition-medium);
}

/* Syst√®me de raret√© */
.rarity-common { border: 2px solid #9e9e9e; }
.rarity-rare { border: 2px solid #4caf50; }
.rarity-epic { 
  border: 2px solid #2196f3;
  box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
}
.rarity-legendary { 
  border: 2px solid #ffc107;
  box-shadow: 0 0 15px rgba(255, 193, 7, 0.5);
  animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
  from { box-shadow: 0 0 15px rgba(255, 193, 7, 0.5); }
  to { box-shadow: 0 0 25px rgba(255, 193, 7, 0.8); }
}
```

### **Phase 2: Architecture du Syst√®me**

#### **Classes Principales**
```javascript
class KidsTasksAvatarBuilder {
  generateAvatar(childData) {
    return {
      base: this.generateBody(childData.skin_tone),
      hair: this.generateHair(childData.hair_style, childData.hair_color),
      eyes: this.generateEyes(childData.eye_color),
      outfit: this.combineOutfit(childData.equipped_cosmetics)
    };
  }
  
  combineOutfit(equippedItems) {
    // Logique de combinaison des √©l√©ments
    // Gestion des incompatibilit√©s
    // G√©n√©ration du CSS final
  }
}

class KidsTasksCosmeticManager {
  constructor() {
    this.collections = {};
    this.childInventories = new Map();
    this.preloadedAssets = new Map();
  }
  
  loadCollection(collectionName) {
    // Chargement lazy des collections
  }
  
  unlockItem(childId, itemId) {
    // D√©blocage d'un cosm√©tique
    // V√©rification des conditions
    // Mise √† jour de l'inventaire
  }
  
  equipItem(childId, itemId) {
    // √âquipement d'un cosm√©tique
    // V√©rification des compatibilit√©s
    // Mise √† jour de l'apparence
  }
}
```

### **Phase 3: Int√©gration dans les Cartes**

#### **Modification des Cards Existantes**
```javascript
// Dans child-card.js
getAvatar(child) {
  if (child.cosmetics && child.cosmetics.equipped) {
    return this.cosmeticManager.renderAvatar(child.cosmetics);
  }
  // Fallback vers emoji
  return child.avatar || child.cosmetics?.avatar?.emoji || 'üë§';
}

// Nouvel onglet cosm√©tiques
renderCosmeticsTab(child) {
  return `
    <div class="cosmetics-tab">
      <div class="avatar-display">
        ${this.renderFullAvatar(child)}
      </div>
      <div class="cosmetic-inventory">
        ${this.renderInventory(child.id)}
      </div>
      <button class="kt-btn kt-btn--primary" data-action="open-avatar-builder">
        Personnaliser
      </button>
    </div>
  `;
}
```

### **Phase 4: Syst√®me de D√©blocage**

#### **Int√©gration avec les R√©compenses**
```javascript
// Modification du syst√®me de r√©compenses existant
class KidsTasksRewardSystem {
  async completeTask(taskId, childId) {
    // Logique existante...
    
    // Nouveau : Check cosmetic rewards
    const cosmeticReward = this.checkCosmeticReward(taskId);
    if (cosmeticReward) {
      await this.unlockCosmetic(childId, cosmeticReward);
      this.showCosmeticUnlockAnimation(cosmeticReward);
    }
  }
  
  checkCosmeticReward(taskId) {
    // Logique pour d√©terminer si une t√¢che donne un cosm√©tique
    // Bas√© sur la difficult√©, cat√©gorie, achievements, etc.
  }
}
```

## üì± **Interface Utilisateur**

### **Avatar Builder Interface**
```html
<div class="kt-avatar-builder">
  <!-- Panneau gauche : Cat√©gories -->
  <div class="cosmetic-categories">
    <button class="category-btn active" data-category="hair">Cheveux</button>
    <button class="category-btn" data-category="eyes">Yeux</button>
    <button class="category-btn" data-category="outfit">Tenues</button>
    <button class="category-btn" data-category="accessory">Accessoires</button>
  </div>
  
  <!-- Centre : Aper√ßu avatar -->
  <div class="avatar-preview">
    <div class="avatar-container">
      <!-- Avatar SVG g√©n√©r√© dynamiquement -->
    </div>
    <div class="avatar-controls">
      <button class="kt-btn kt-btn--secondary">R√©initialiser</button>
      <button class="kt-btn kt-btn--primary">Sauvegarder</button>
    </div>
  </div>
  
  <!-- Panneau droit : Items de la cat√©gorie -->
  <div class="cosmetic-items">
    <div class="items-grid">
      <!-- Items g√©n√©r√©s dynamiquement -->
    </div>
  </div>
</div>
```

### **Animation de D√©blocage**
```css
@keyframes unlock-item {
  0% { 
    transform: scale(0) rotate(180deg);
    opacity: 0;
  }
  50% { 
    transform: scale(1.2) rotate(0deg);
    opacity: 1;
  }
  100% { 
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
}

.cosmetic-unlock {
  animation: unlock-item 0.8s ease-out;
}
```

## üîß **Aspects Techniques**

### **Optimisation Performance**
- **Lazy loading** des assets SVG
- **Cache** des rendus g√©n√©r√©s
- **Sprites CSS** pour les petits √©l√©ments
- **Compression** des donn√©es cosm√©tiques

### **Compatibilit√©**
- **Fallback** vers emojis si SVG non support√©
- **Responsive** design pour mobile
- **Accessibilit√©** avec ARIA labels

### **Structure de Fichiers**
```
src/
‚îú‚îÄ‚îÄ cosmetics/
‚îÇ   ‚îú‚îÄ‚îÄ cosmetic-manager.js       # Gestionnaire principal
‚îÇ   ‚îú‚îÄ‚îÄ avatar-builder.js         # Constructeur d'avatars
‚îÇ   ‚îú‚îÄ‚îÄ collections/              # Collections de cosm√©tiques
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ daily.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fantasy.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ seasonal.json
‚îÇ   ‚îú‚îÄ‚îÄ assets/                   # Assets SVG
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hair/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ outfits/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ accessories/
‚îÇ   ‚îî‚îÄ‚îÄ styles/                   # CSS sp√©cialis√©
‚îÇ       ‚îú‚îÄ‚îÄ avatar-builder.css
‚îÇ       ‚îî‚îÄ‚îÄ cosmetic-effects.css
‚îú‚îÄ‚îÄ mockups/                      # Prototypes HTML
‚îÇ   ‚îú‚îÄ‚îÄ avatar-builder.html
‚îÇ   ‚îú‚îÄ‚îÄ avatar-layers.html
‚îÇ   ‚îú‚îÄ‚îÄ child-card-cosmetics.html
‚îÇ   ‚îú‚îÄ‚îÄ cosmetic-rewards.html
‚îÇ   ‚îî‚îÄ‚îÄ cosmetic-collections.html
‚îî‚îÄ‚îÄ COSMETICS-SYSTEM.md          # Cette documentation
```

## üéØ **Prochaines √âtapes**

1. **Cr√©er les mockups HTML** pour validation UX
2. **D√©velopper le syst√®me de couches SVG** de base
3. **Int√©grer dans child-card.js** existante
4. **Cr√©er les premi√®res collections** (quotidien + fantaisie)
5. **Syst√®me de d√©blocage** li√© aux t√¢ches
6. **Interface de personnalisation** compl√®te

## üí° **Notes d'Impl√©mentation**

### **Compatibilit√© avec l'Existant**
- R√©utiliser les classes CSS du design system
- Garder la compatibilit√© avec les emojis actuels
- Int√©grer progressivement dans les cartes existantes

### **√âvolutivit√©**
- Syst√®me modulaire pour ajouter facilement nouvelles collections
- API pour import/export de cosm√©tiques personnalis√©s
- Structure pour futurs cosm√©tiques anim√©s

### **Consid√©rations UX**
- Interface intuitive inspir√©e des jeux
- Feedback visuel imm√©diat
- Progression claire et motivante
- Accessibilit√© pour tous les √¢ges

---

**Derni√®re mise √† jour :** 2025-09-11  
**Status :** Sp√©cifications compl√®tes - Pr√™t pour impl√©mentation des mockups